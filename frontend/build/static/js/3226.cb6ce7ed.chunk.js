"use strict";(self.webpackChunkrestaurant=self.webpackChunkrestaurant||[]).push([[3226],{4423:(e,t,a)=>{a.d(t,{Z:()=>s});a(7313);var r=a(6417);const s=e=>{let{message:t,type:a,onClose:s}=e;return(0,r.jsx)("div",{className:"modal",style:{display:"block"},children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsx)("span",{className:"close",onClick:s,children:"\xd7"}),(0,r.jsx)("p",{className:a,children:t})]})})}},3226:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var r=a(4696),s=a(6573),o=a(7313),l=a(7533),c=a(8467),d=a(4423),n=a(6417);const i=()=>{const e=(0,c.s0)(),t=(0,r.useStripe)(),a=(0,r.useElements)(),i=JSON.parse(localStorage.getItem("confirmOrder")),m=JSON.parse(localStorage.getItem("emailOrMobile")),p=JSON.parse(localStorage.getItem("user")),u=JSON.parse(localStorage.getItem("shippingInfo")),y=JSON.parse(localStorage.getItem("billingAddress")),g=JSON.parse(localStorage.getItem("cartItems")),h=JSON.parse(localStorage.getItem("deliveryAddress")),S=JSON.parse(localStorage.getItem("deliveryInstruction")),v=JSON.parse(localStorage.getItem("orderNotes")),N=JSON.parse(localStorage.getItem("selectedTimeSlot")),b=JSON.parse(localStorage.getItem("restaurantId")),f=JSON.parse(localStorage.getItem("branch")),x=JSON.parse(localStorage.getItem("Address")),I=JSON.parse(localStorage.getItem("selectedDate")),C=JSON.parse(localStorage.getItem("user")),[O,j]=(0,o.useState)(null),_={amount:Math.round(i.orderSummary.total),shipping:{name:"".concat((null===p||void 0===p?void 0:p.name)||u.name," ").concat((null===p||void 0===p?void 0:p.lastName)||u.lastName),phone:(null===p||void 0===p?void 0:p.phone)||m,address:{line1:null===y||void 0===y?void 0:y.streetAddress,line2:null,city:null===y||void 0===y?void 0:y.city,state:null===y||void 0===y?void 0:y.state,postal_code:null===y||void 0===y?void 0:y.postalCode,country:null===y||void 0===y?void 0:y.country}}};return(0,o.useEffect)((()=>{j(null)}),[O]),(0,n.jsxs)("div",{className:"bg-white p-5",children:[(0,n.jsx)("div",{className:"col-12 CardImg114 bg-white col-lg-6 mx-auto ",children:(0,n.jsx)(l.Z,{onSubmit:async o=>{o.preventDefault(),document.querySelector("#pay_btn").disabled=!0;try{const{data:o}=await s.Z.post("/api/payment/process",_),c=o.client_secret,d=a.getElement(r.CardNumberElement),n=await t.confirmCardPayment(c,{payment_method:{card:d,billing_details:{name:"".concat((null===p||void 0===p?void 0:p.name)||u.name," ").concat((null===p||void 0===p?void 0:p.lastName)||u.lastName),email:(null===p||void 0===p?void 0:p.email)||m}}});if(n.error)setAlert({message:n.error.message,type:"error"}),document.querySelector("#pay_btn").disabled=!1;else if("succeeded"===n.paymentIntent.status){localStorage.setItem("payment",JSON.stringify(n));const t={shipping:{name:"".concat(u.name," ").concat(u.lastName),email:u.email,phone:u.mobileNumber,emailOrMobile:m,address:{user:u.name,email:u.email,emailOrMobile:m,phone:u.mobileNumber,line1:y.streetAddress,city:y.city,orderType:u.orderType,state:y.state,postalCode:y.postalCode,country:y.country}},delivery:h?{line1:h.streetAddress,city:h.city,state:h.state,postalCode:h.postalCode,country:h.country}:void 0,items:g.map((e=>({name:e.name,image:e.images[0].image||"https://via.placeholder.com/20",price:e.price,itemQuantity:e.quantity}))),orderNotes:v,userId:(null===C||void 0===C?void 0:C._id)||"Guest",deliveryInstruction:S,itemsPrice:i.orderSummary.estimatedTotal,taxPrice:i.orderSummary.tax,shippingPrice:i.orderSummary.shipping,totalPrice:i.orderSummary.total,paymentInfo:n.paymentIntent.id,orderInstruction:v,paymentStatus:n.paymentIntent.status,restaurantId:b,restaurantBranch:"".concat(f,", ").concat(x),orderType:i.shippingInfo.orderType,selectedTimeSlot:"".concat(N),orderDate:I};try{const a=await s.Z.post("/api/order/new",t);console.log("Order created:",a.data),e("/order/success"),localStorage.removeItem("cartItems")}catch(l){console.error("Error creating order:",l.message),setAlert({message:"Order creation failed, please contact support!",type:"error"})}}else setAlert({message:"Payment failed, Please try again!",type:"success"})}catch(c){console.error("Error processing payment:",c.message)}},className:"shadow-lg  custom-table",id:"CardBackIMg1",children:(0,n.jsxs)("div",{className:"my-2 p-2",children:[(0,n.jsx)("h5",{className:"mb-4 text-center",id:"CardText",children:"CARD INFO"}),(0,n.jsxs)("div",{className:"form-group my-3",children:[(0,n.jsx)("h6",{htmlFor:"card_num_field",id:"CardText",children:"Card Number"}),(0,n.jsx)(r.CardNumberElement,{type:"text",style:{backgroundColor:"#d4ffe8",color:"black"},id:"card_num_field",className:"form-control "})]}),(0,n.jsxs)("div",{className:"form-group my-3",children:[(0,n.jsx)("h6",{htmlFor:"card_exp_field",id:"CardText",children:"Card Expiry"}),(0,n.jsx)(r.CardExpiryElement,{style:{backgroundColor:"#d4ffe8",color:"black"},type:"text",id:"card_exp_field",className:"form-control"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("h6",{htmlFor:"card_cvc_field",children:"Card CVC"}),(0,n.jsx)(r.CardCvcElement,{style:{backgroundColor:"#d4ffe8",color:"black"},type:"password",id:"card_cvc_field",className:"form-control ",value:""})]}),(0,n.jsx)("div",{className:"d-flex justify-content-center",children:(0,n.jsxs)("button",{id:"pay_btn",type:"submit",className:"btn btn my-color mt-3",children:["Pay -"," "," $".concat(i.orderSummary&&i.orderSummary.total)]})})]})})}),alert.message&&(0,n.jsx)(d.Z,{message:alert.message,type:alert.type,onClose:()=>{setAlert({message:"",type:""})}})]})}}}]);