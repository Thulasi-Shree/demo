"use strict";(self.webpackChunkrestaurant=self.webpackChunkrestaurant||[]).push([[3226],{3226:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var r=a(4696),o=a(6573),s=a(7313),l=a(7533),d=a(8467),c=a(4423),n=a(6417);const i=()=>{const e=(0,d.s0)(),t=(0,r.useStripe)(),a=(0,r.useElements)(),i=JSON.parse(localStorage.getItem("confirmOrder")),m=JSON.parse(localStorage.getItem("emailOrMobile")),p=JSON.parse(localStorage.getItem("user")),u=JSON.parse(localStorage.getItem("shippingInfo")),g=JSON.parse(localStorage.getItem("billingAddress")),y=(JSON.parse(localStorage.getItem("cartItems")),JSON.parse(localStorage.getItem("deliveryAddress"))),S=JSON.parse(localStorage.getItem("deliveryInstruction")),h=JSON.parse(localStorage.getItem("orderNotes")),v=JSON.parse(localStorage.getItem("selectedTimeSlot")),N=JSON.parse(localStorage.getItem("restaurantId")),b=JSON.parse(localStorage.getItem("branch")),f=JSON.parse(localStorage.getItem("Address")),I=JSON.parse(localStorage.getItem("selectedDate")),x=JSON.parse(localStorage.getItem("user")),[C,O]=(0,s.useState)(null),_={amount:Math.round(i.orderSummary.total),shipping:{name:"".concat((null===p||void 0===p?void 0:p.name)||u.name," ").concat((null===p||void 0===p?void 0:p.lastName)||u.lastName),phone:(null===p||void 0===p?void 0:p.phone)||m,address:{line1:null===g||void 0===g?void 0:g.streetAddress,line2:null,city:null===g||void 0===g?void 0:g.city,state:null===g||void 0===g?void 0:g.state,postal_code:null===g||void 0===g?void 0:g.postalCode,country:null===g||void 0===g?void 0:g.country}}};return(0,s.useEffect)((()=>{O(null)}),[C]),(0,n.jsxs)("div",{className:"bg-white p-5",children:[(0,n.jsx)("div",{className:"col-12 CardImg114 bg-white col-lg-6 mx-auto ",children:(0,n.jsx)(l.Z,{onSubmit:async s=>{s.preventDefault(),document.querySelector("#pay_btn").disabled=!0;try{const{data:s}=await o.Z.post("/api/payment/process",_),d=s.client_secret,c=a.getElement(r.CardNumberElement),n=await t.confirmCardPayment(d,{payment_method:{card:c,billing_details:{name:"".concat((null===p||void 0===p?void 0:p.name)||u.name," ").concat((null===p||void 0===p?void 0:p.lastName)||u.lastName),email:(null===p||void 0===p?void 0:p.email)||m}}});if(n.error)setAlert({message:n.error.message,type:"error"}),document.querySelector("#pay_btn").disabled=!1;else if("succeeded"===n.paymentIntent.status){localStorage.setItem("payment",JSON.stringify(n));const t={shipping:{name:"".concat(u.name," ").concat(u.lastName),email:u.email,phone:u.mobileNumber,emailOrMobile:m,address:{user:u.name,email:u.email,emailOrMobile:m,phone:u.mobileNumber,line1:g.streetAddress,city:g.city,orderType:u.orderType,state:g.state,postalCode:g.postalCode,country:g.country}},delivery:y?{line1:y.streetAddress,city:y.city,state:y.state,postalCode:y.postalCode,country:y.country}:void 0,orderNotes:h,userId:(null===x||void 0===x?void 0:x._id)||"Guest",deliveryInstruction:S,itemsPrice:i.orderSummary.estimatedTotal,taxPrice:i.orderSummary.tax,shippingPrice:i.orderSummary.shipping,totalPrice:i.orderSummary.total,paymentInfo:n.paymentIntent.id,orderInstruction:h,paymentStatus:n.paymentIntent.status,restaurantId:N,restaurantBranch:"".concat(b,", ").concat(f),orderType:i.shippingInfo.orderType,selectedTimeSlot:"".concat(v),orderDate:I};try{const a=await o.Z.post("/api/order/new",t);console.log("Order created:",a.data),e("/order/success"),localStorage.removeItem("cartItems")}catch(l){console.error("Error creating order:",l.message),setAlert({message:"Order creation failed, please contact support!",type:"error"})}}else setAlert({message:"Payment failed, Please try again!",type:"success"})}catch(d){console.error("Error processing payment:",d.message)}},className:"shadow-lg bg-white custom-table",id:"CardBackIMg1",children:(0,n.jsxs)("div",{className:"my-2 p-2",children:[(0,n.jsx)("h5",{className:"mb-4 text-center",id:"CardText",children:"CARD INFO"}),(0,n.jsxs)("div",{className:"form-group my-3",children:[(0,n.jsx)("h6",{htmlFor:"card_num_field",id:"CardText",children:"Card Number"}),(0,n.jsx)(r.CardNumberElement,{type:"text",style:{backgroundColor:"#d4ffe8",color:"black"},id:"card_num_field",className:"form-control "})]}),(0,n.jsxs)("div",{className:"form-group my-3",children:[(0,n.jsx)("h6",{htmlFor:"card_exp_field",id:"CardText",children:"Card Expiry"}),(0,n.jsx)(r.CardExpiryElement,{style:{backgroundColor:"#d4ffe8",color:"black"},type:"text",id:"card_exp_field",className:"form-control"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("h6",{htmlFor:"card_cvc_field",children:"Card CVC"}),(0,n.jsx)(r.CardCvcElement,{style:{backgroundColor:"#d4ffe8",color:"black"},type:"password",id:"card_cvc_field",className:"form-control ",value:""})]}),(0,n.jsx)("div",{className:"d-flex justify-content-center",children:(0,n.jsxs)("button",{id:"pay_btn",type:"submit",className:"btn btn my-color mt-3",children:["Pay -"," "," $".concat(i.orderSummary&&i.orderSummary.total)]})})]})})}),alert.message&&(0,n.jsx)(c.Z,{message:alert.message,type:alert.type,onClose:()=>{setAlert({message:"",type:""})}})]})}}}]);